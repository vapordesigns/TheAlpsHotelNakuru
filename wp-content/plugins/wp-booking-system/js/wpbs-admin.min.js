function wpbs_htmlEscape(s){return String(s).replace(/&/g,"--AMP--").replace(/"/g,"--DOUBLEQUOTE--").replace(/'/g,"--QUOTE--").replace(/</g,"--LT--").replace(/>/g,"--GT--")}function wpbs_customReplace(s){return String(s).replace(/--AMP--/g,"&").replace(/--DOUBLEQUOTE--/g,'"').replace(/--QUOTE--/g,"'").replace(/--LT--/g,"<").replace(/--GT--/g,">")}function showLoader(){wpbs(".wpbs-loading").fadeTo(0,0).css("display","block").fadeTo(200,1),wpbs(".wpbs-calendar ul").animate({opacity:"0.7"},200)}function hideLoader(){wpbs(".wpbs-loading").css("display","none")}function wpbs_changeDay(s,a){var t={action:"wpbs_changeDayAdmin",calendarDirection:s,totalCalendars:$instance.find(".wpbs-total-calendars").html(),currentTimestamp:a,calendarData:$instance.find(".wpbs-calendar-data").attr("data-info"),calendarHistory:$instance.find(".wpbs-calendar-history").html(),calendarLegend:$instance.find(".wpbs-calendar-legend").attr("data-info"),showDropdown:$instance.find(".wpbs-show-dropdown").html(),autoPending:$instance.find(".wpbs-calendar-auto-pending").html(),weekNumbers:$instance.find(".wpbs-calendar-week-numbers").html(),calendarSelectionType:$instance.find(".wpbs-calendar-selection-type").html(),calendarLanguage:$instance.find(".wpbs-calendar-language").html(),weekStart:$instance.find(".wpbs-calendar-week-start").html(),calendarID:$instance.find(".wpbs-calendar-ID").html()};wpbs.ajax({type:"POST",url:wpbs_ajaxurl,contentType:"application/json; charset=utf-8",dataType:"html",data:JSON.stringify(t),success:function(s){$instance.find(".wpbs-calendars").html(s),hideLoader(),wpbs(".wpbs-chosen").chosen()}})}function wpbs_makeid(){for(var s="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",t=0;t<5;t++)s+=a.charAt(Math.floor(Math.random()*a.length));return s}function wpbs_saveCalendar(s){if(1==$saveCalendarDisabled)return!1;var a={action:"wpbs_saveCalendar",users:wpbs('[name="wpbs-calendar-users[]"]').map(function(){return wpbs(this).val()}).get(),title:wpbs('[name="calendarTitle"]').val(),data:wpbs("#inputCalendarData").val(),id:wpbs('[name="calendarID"]').val()};wpbs.ajax({type:"POST",url:wpbs_ajaxurl,contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(a),success:function(s){wpbs("body").scrollTop(0),wpbs("#wpbs-notification-wrapper").append('<div id="wpbs-notice" class="notice notice-'+s.class+' is-dismissible"><p>'+s.msg+"</p></div>");setTimeout(function(){wpbs("#wpbs-notice").remove()},2e3);if(void 0!==s.url){$saveCalendarDisabled=!0,wpbs(".wpbs_saveCalendar").attr("disabled",!0);setTimeout(function(){window.location.href=""+s.url},2050)}else{setTimeout(function(){window.location.reload()},1500)}}})}function objectifyForm(s){for(var a={},t=0;t<s.length;t++)a[s[t].name]=s[t].value;return a}function wpbs_saveForm(){var s=function(s){var a=[];return wpbs(s+" input, "+s+" select, "+s+" textarea").each(function(s,t){field=wpbs(this),"autoreply_include_details"==field.attr("name")?a.push({input:field.attr("name"),value:field.prop("checked")}):a.push({input:field.attr("name"),value:field.val()})}),a};if(1==$saveFormDisabled)return!1;var a={id:wpbs('[name="formID"]').val(),title:wpbs('[name="formTitle"]').val(),fields:function(){var s;return wpbs("#wpbs-form-json").length>0&&(s=wpbs("#wpbs-form-json").val()),s}(),translations:s(".translations"),formSettings:s(".form-settings"),autoreply:s(".auto-reply"),emailSettings:s(".email-settings")},t={action:"wpbs_saveForm",data:a};wpbs.ajax({type:"POST",url:wpbs_ajaxurl,contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(t),success:function(s){if(wpbs("body").scrollTop(0),wpbs("#wpbs-notification-wrapper").append('<div id="wpbs-notice" class="notice notice-'+s.class+' is-dismissible"><p>'+s.msg+"</p></div>"),0==s.result)return!1;setTimeout(function(){wpbs("#wpbs-notice").remove()},3e3);if(void 0!==s.url){$saveFormDisabled=!0,wpbs(".wpbs_saveForm").attr("disabled",!0);setTimeout(function(){window.location.href=""+s.url},3350)}else{setTimeout(function(){window.location.reload()},1500)}}})}function wpbs_bookingAction(){var s=wpbs("#bookingInfo"),a=wpbs(".wpbs-bookings-tabs"),t={action:"wpbs_bookingAction",bookingAction:s.attr("data-booking-action"),bookingId:s.attr("data-booking-id"),calendarId:s.attr("data-calendar-id"),from:s.attr("data-booking-from"),dates:JSON.stringify(wpbs("#wpbs_ModalDatesEditor").serializeArray()),statuses:{pending:a.find("#status-pending").html().replace(/"/g,"").replace(/'/g,"").replace(/\(|\)/g,""),accepted:a.find("#status-accepted").html().replace(/"/g,"").replace(/'/g,"").replace(/\(|\)/g,""),trash:a.find("#status-trash").html().replace(/"/g,"").replace(/'/g,"").replace(/\(|\)/g,"")},send_confirmation:wpbs(".send-confirmation-message").val(),confirmation_message:wpbs(".send-confirmation-message-additional").val()};wpbs.ajax({type:"POST",url:wpbs_ajaxurl,contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(t),success:function(s){if(wpbs_random_id=wpbs_makeid(),s.status){wpbs("body").scrollTop(0),wpbs("#wpbs-notification-wrapper").append('<div id="'+wpbs_random_id+'" class="notice notice-'+s.class+' is-dismissible"><p>'+s.msg+"</p></div>"),wpbs("#wpbs-booking-field-"+s.id).removeClass("wpbs-booking-selected wpbs-booking-move wpbs-booking-delete").addClass(s.action_class),wpbs("#status-pending").html(s.statuses.pending),wpbs("#status-accepted").html(s.statuses.accepted),wpbs("#status-trash").html(s.statuses.trash);setTimeout(function(){wpbs("#wpbs-booking-field-"+s.id).closest("tr").remove(),wpbs("#"+wpbs_random_id).remove()},1e3);wpbs_saveCalendar(!0)}else wpbs("#wpbs-notification-wrapper").append('<div id="'+wpbs_random_id+'" class="notice notice-error is-dismissible"><p>Something went wrong</p></div>');setTimeout(function(){wpbs("#"+wpbs_random_id).remove()},1e3)}})}function wpbs_select_text(s){if(document.selection){var a=document.body.createTextRange();a.moveToElementText(s),a.select()}else if(window.getSelection){var a=document.createRange();a.selectNode(s),window.getSelection().addRange(a)}}var wpbs=jQuery.noConflict(),$instance,$saveCalendarDisabled=!1,$saveFormDisabled=!1;String.prototype.stripSlashes=function(){return this.replace(/\\(.)/gm,"$1")},wpbs(document).ready(function(){wpbs(".wpbs-chosen").chosen(),wpbs(".wpbs-wrap .meta-box-sortables").sortable({disabled:!0}),wpbs(".wpbs_saveCalendar").each(function(){wpbs(this).on("click",function(){wpbs_saveCalendar()})}),wpbs(".wpbs_saveForm").each(function(){wpbs(this).on("click",function(){wpbs_saveForm()})}),wpbs("#wpbs_bookingAction").each(function(){wpbs(this).on("click",function(){wpbs_bookingAction()})}),wpbs(".wpbs-container").each(function(){$instance=wpbs(this),wpbs($instance).on("change",".wpbs-dropdown",function(s){showLoader(),s.preventDefault(),wpbs_changeDay("jump",wpbs(this).val())}),wpbs($instance).on("click",".wpbs-prev",function(s){showLoader(),s.preventDefault(),0==$instance.find(".wpbs-current-timestamp a").length?timestamp=$instance.find(".wpbs-current-timestamp").html():timestamp=$instance.find(".wpbs-current-timestamp a").html(),wpbs_changeDay("prev",timestamp)}),wpbs($instance).on("click",".wpbs-next",function(s){showLoader(),s.preventDefault(),0==$instance.find(".wpbs-current-timestamp a").length?timestamp=$instance.find(".wpbs-current-timestamp").html():timestamp=$instance.find(".wpbs-current-timestamp a").html(),wpbs_changeDay("next",timestamp)})}),wpbs(document).on("click","#calendarBatchUpdate",function(s){s.preventDefault();var a=wpbs(".wpbs-calendar-data").attr("data-info");a?(a=wpbs_customReplace(a.stripSlashes()),a=JSON.parse(a)):a={};var t=wpbs(".wpbs-current-timestamp").html(),e=new Date(1e3*t),n=wpbs("#startDay").val(),p=wpbs("#startMonth").val(),o=wpbs("#startYear").val(),l=wpbs("#endDay").val(),r=wpbs("#endMonth").val(),d=wpbs("#endYear").val(),b=wpbs("#changeStatus").val(),c=wpbs("#bookingDetails").val(),w=Date.parse(n+" "+p+" "+o)/1e3,m=Date.parse(l+" "+r+" "+d)/1e3;if(w<m)for(i=w;i<=m+82800;i+=86400){var u=new Date(1e3*i);u.getMonth()==e.getMonth()&&u.getFullYear()==e.getFullYear()&&(wpbs("select.wpbs-day-"+u.getDate()).find("option.wpbs-option-"+b).prop("selected")||(wpbs("select.wpbs-day-"+u.getDate()).find("option").prop("selected",!1),wpbs("select.wpbs-day-"+u.getDate()).find("option.wpbs-option-"+b).prop("selected",!0)),wpbs("select.wpbs-day-"+u.getDate()).parents("li").find("span.wpbs-select-status").removeClass().addClass("wpbs-select-status status-"+b),wpbs("select.wpbs-day-"+u.getDate()).parents("li").find("span.wpbs-day-split-top").removeClass().addClass("wpbs-day-split-top wpbs-day-split-top-"+b),wpbs("select.wpbs-day-"+u.getDate()).parents("li").find("span.wpbs-day-split-bottom").removeClass().addClass("wpbs-day-split-bottom wpbs-day-split-bottom-"+b),wpbs("select.wpbs-day-"+u.getDate()).parents("li").find(".wpbs-input-description").val(c),wpbs(".wpbs-calendars li.wpbs-day-"+u.getDate()).removeClass().addClass("wpbs-day wpbs-day-"+u.getDate()+" status-"+b),wpbs(".wpbs-calendars li.wpbs-day-"+u.getDate()+" span.wpbs-day-split-top").removeClass().addClass("wpbs-day-split-top wpbs-day-split-top-"+b),wpbs(".wpbs-calendars li.wpbs-day-"+u.getDate()+" span.wpbs-day-split-bottom").removeClass().addClass("wpbs-day-split-bottom wpbs-day-split-bottom-"+b));var f="year"+u.getFullYear(),g="month"+(u.getMonth()+1),h="day"+u.getDate(),t=wpbs(".wpbs-current-timestamp").html(),e=new Date(1e3*t),g=u.getMonth()+1,f=u.getFullYear(),h=u.getDate();f in a||(a[f]={}),g in a[f]||(a[f][g]={}),a[f][g][h]=b,a[f][g]["description-"+h]=c,wpbs("span.error").css("display","none")}else wpbs("span.error").css("display","block");wpbs(".wpbs-calendar-data").attr("data-info",JSON.stringify(a)),wpbs("#inputCalendarData").val(JSON.stringify(a))}),wpbs(document).on("change",".wpbs-day-select",function(s){var a=wpbs_customReplace(wpbs(".wpbs-calendar-data").attr("data-info"));a?(a=wpbs_customReplace(a.stripSlashes()),a=JSON.parse(a)):a={};var t=wpbs(".wpbs-current-timestamp").html(),e=(new Date(1e3*t),wpbs(this).attr("data-month").replace("wpbs-month-","")),n=wpbs(this).attr("data-year").replace("wpbs-year-",""),p=wpbs(this).attr("data-name").replace("wpbs-day-",""),i=wpbs(this).val();n in a||(a[n]={}),e in a[n]||(a[n][e]={}),a[n][e][p]=i,wpbs(this).parent().find("span.wpbs-select-status").removeClass().addClass("wpbs-select-status status-"+i),wpbs(this).parent().find("span.wpbs-day-split-top").removeClass().addClass("wpbs-day-split-top wpbs-day-split-top-"+i),wpbs(this).parent().find("span.wpbs-day-split-bottom").removeClass().addClass("wpbs-day-split-bottom wpbs-day-split-bottom-"+i),0==wpbs(this).parents(".wpbs-modal-box").length&&(wpbs(".wpbs-calendar li.wpbs-day-"+p).removeClass().addClass("wpbs-day wpbs-day-"+p+" status-"+i),wpbs(".wpbs-calendar li.wpbs-day-"+p+" span.wpbs-day-split-top").removeClass().addClass("wpbs-day-split-top wpbs-day-split-top-"+i),wpbs(".wpbs-calendar li.wpbs-day-"+p+" span.wpbs-day-split-bottom").removeClass().addClass("wpbs-day-split-bottom wpbs-day-split-bottom-"+i)),wpbs(".wpbs-calendar-data").attr("data-info",JSON.stringify(a)),wpbs("#inputCalendarData").val(JSON.stringify(a))}),wpbs(document).on("keyup",".wpbs-input-description",function(s){var a=wpbs(".wpbs-calendar-data").attr("data-info");a?(a=wpbs_customReplace(a.stripSlashes()),a=JSON.parse(a)):a={};var t=wpbs(".wpbs-current-timestamp").html(),e=(new Date(1e3*t),wpbs(this).attr("data-month").replace("wpbs-month-","")),n=wpbs(this).attr("data-year").replace("wpbs-year-",""),p=wpbs(this).attr("data-name").replace("wpbs-day-",""),i=wpbs(this).val();n in a||(a[n]={}),e in a[n]||(a[n][e]={}),a[n][e]["description-"+p]=wpbs_htmlEscape(i),wpbs(".wpbs-calendar-data").attr("data-info",JSON.stringify(a)),wpbs("#inputCalendarData").val(JSON.stringify(a))}),wpbs(".saveCalendar").click(function(){return!!wpbs.trim(wpbs(".fullTitle").val()).length||(wpbs(".fullTitle").addClass("error").focus(),!1)}),wpbs(document).on("click",".bulk-edit-legend-apply",function(){wpbs(".edit-dates-popup select").each(function(){wpbs(this).val(wpbs(".bulk-edit-legend-select").val()).trigger("change")}),wpbs(".edit-dates-popup input").each(function(){wpbs(this).val(wpbs(".bulk-edit-legend-text").val()).trigger("keyup")})})});