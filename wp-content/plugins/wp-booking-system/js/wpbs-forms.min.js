function wpbs_delete_field(e){formJson=wpbs_form_getJson(),wpbs(".wpbs-form-field").each(function(){fieldId=wpbs(this).attr("data-order"),fieldId==e&&(wpbs(this).remove(),delete formJson[e])});var s=1;wpbs(".wpbs-form-field").each(function(){wpbs(this).attr("data-order",s),s++}),wpbs_form_saveJson(formJson)}function wpbs_sort_forms(e){tempFormJson={},currFormJson=wpbs_form_getJson();for(var s in e)tempFormJson[e[s]]=currFormJson[s];wpbs_form_saveJson(tempFormJson),x=1,wpbs(".wpbs-form-field").each(function(){wpbs(this).attr("data-order",x),x++})}function wpbs_form_addNewField(){var e="";i=wpbs(".wpbs-form-field").length+1,fieldId=0,wpbs(".wpbs-form-field").each(function(){parseInt(fieldId)<parseInt(wpbs(this).attr("id").replace("wpbs-form-field-",""))&&(fieldId=parseInt(wpbs(this).attr("id").replace("wpbs-form-field-","")))}),fieldId++,e+='<div class="wpbs-form-field wpbs-form-field-'+fieldId+'" data-order="'+i+'" id="wpbs-form-field-'+fieldId+'">',e+='<a href="#" class="wpbs-form-move" title="Move"><!-- --></a>',e+='<a href="#" class="wpbs-form-delete" title="Delete"><!-- --></a>',e+='<span class="wpbs-field-name">New Field</span><span class="wpbs-field-type">Text</span>',e+='<div class="wpbs-field-options" style="display:none;">',e+='<p><label>Title</label><input type="text" name="fieldName" class="fieldName"></p>',e+='<p><label>Type</label><select class="fieldType" name="fieldType"><option value="text">Text</option><option value="email">Email</option><option value="textarea">Textarea</option><option value="checkbox">Checkboxes</option><option value="radio">Radio Buttons</option><option value="dropdown">Dropdown</option><option value="html">HTML</option></select></p>',e+='<p style="display:none;" class="fieldOptionsContainer"><label>Options</label><input type="text" name="fieldOptions" class="fieldOptions"><small><em>Separate values with an | (eg. Option 1|Option 2|Option 3)</em></small><br /><a class="wpbs-show-dropdown-translations" href="#">show translations</a></p>',e+='<span class="wpbs-dropdown-translations" style="display:none;">';for(var s in activeLanguages)e+="<p><label>"+activeLanguages[s]+'</label><input type="text" name="'+s+'" class="fieldOptionsLanguage fieldOptionsLanguage-'+s+'"></p>';e+="</span>",e+='<p style="display:none;" class="fieldHtmlContainer"><label>Content</label><textarea name="fieldHTML" class="fieldHTML" rows="10" cols="80"></textarea></p>',e+='<p class="fieldRequiredParent"><label>Required</label><input type="checkbox" name="fieldRequired" class="fieldRequired"></p>',e+='<div class="wpbs-form-line"><!-- --></div>';for(var s in activeLanguages)e+="<p><label>"+activeLanguages[s]+'</label><input type="text" name="'+s+'" class="languageField languageField-'+s+'"></p>';e+="</div>",e+="</div>",wpbs("#wpbs-form-container").append(e),formJson=wpbs_form_getJson(),formJson[i]={},formJson[i].fieldId=fieldId,formJson[i].fieldName="",formJson[i].fieldType="text",formJson[i].fieldOptions="",formJson[i].fieldHTML="",formJson[i].fieldRequired="false",formJson[i].fieldLanguages={},formJson[i].fieldOptionsLanguages={};for(var s in activeLanguages)formJson[i].fieldLanguages[s]="",formJson[i].fieldOptionsLanguages[s]="";wpbs_form_saveJson(formJson),wpbs("#wpbs-form-field-"+fieldId+" .wpbs-field-name").click()}function wpbs_form_getJson(){return JSON.parse(wpbs("#wpbs-form-json").val())}function wpbs_form_saveJson(e){wpbs("#wpbs-form-json").val(JSON.stringify(e))}var activeLanguages={};wpbs(document).ready(function(){wpbs("#receive_emails").change(function(){wpbs(this).val(),wpbs("#send_to_emails").slideToggle()}),wpbs("#enable_autoreply").change(function(){wpbs(this).val(),wpbs("#wpbs-auto-reply").slideToggle()}),wpbs("#add-field").click(function(e){e.preventDefault(),wpbs(".wpbs-form-field.open").removeClass("open").find(".wpbs-field-options").hide(),wpbs_form_addNewField()}),wpbs("#wpbs-form-container").on("click",".wpbs-form-delete",function(e){e.preventDefault(),confirmation=confirm("Are you sure you want to delete this field?"),confirmation&&wpbs_delete_field(wpbs(this).parent().attr("data-order"))}),wpbs("#wpbs-form-container").on("mousedown click",".wpbs-form-move",function(e){e.preventDefault(),wpbs(this).parent().hasClass("open")&&(wpbs(this).parent().toggleClass("open"),wpbs(this).parent().find(".wpbs-field-options").hide())}),wpbs("#wpbs-form-container").on("click","span.wpbs-field-name, span.wpbs-field-type",function(e){e.preventDefault(),wpbs(".wpbs-form-field.open .wpbs-field-options").slideToggle(),wpbs(this).parent().hasClass("open")?wpbs(".wpbs-form-field.open").removeClass("open"):(wpbs(".wpbs-form-field.open").removeClass("open"),wpbs(this).parent().addClass("open"),wpbs(this).parent().find(".wpbs-field-options").slideToggle())}),wpbs("#wpbs-form-container").on("click",".wpbs-show-dropdown-translations",function(e){e.preventDefault();var s=wpbs(this).parents(".wpbs-form-field");s.find(".wpbs-dropdown-translations").hasClass("visible")?(wpbs(this).text("show translations"),s.find(".wpbs-dropdown-translations").hide().removeClass("visible")):(wpbs(this).text("hide translations"),s.find(".wpbs-dropdown-translations").show().addClass("visible"))}),wpbs("#wpbs-form-container").on("change",".fieldType",function(e){e.preventDefault(),"dropdown"==wpbs(this).val()||"radio"==wpbs(this).val()||"checkbox"==wpbs(this).val()?wpbs(this).parent().parent().find(".fieldOptionsContainer").show():wpbs(this).parent().parent().find(".fieldOptionsContainer").hide(),"html"==wpbs(this).val()?(wpbs(this).parent().parent().find(".fieldHtmlContainer").show(),wpbs(this).parent().parent().find(".fieldRequiredParent").hide()):(wpbs(this).parent().parent().find(".fieldHtmlContainer").hide(),wpbs(this).parent().parent().find(".fieldRequiredParent").show()),wpbs(this).parent().parent().parent().find("span.wpbs-field-type").html(wpbs(this).find("option:selected").text()),formJson=wpbs_form_getJson(),fieldId=wpbs(this).parents(".wpbs-form-field").attr("data-order"),formJson[fieldId].fieldType=wpbs(this).val(),wpbs_form_saveJson(formJson)}),wpbs("#wpbs-form-container").on("keyup change",".fieldName",function(e){e.preventDefault(),$val=wpbs(this).val(),""==$val&&($val="&nbsp;"),wpbs(this).parent().parent().parent().find("span.wpbs-field-name").html($val),formJson=wpbs_form_getJson(),fieldId=wpbs(this).parents(".wpbs-form-field").attr("data-order"),formJson[fieldId].fieldName=wpbs_htmlEscape(wpbs(this).val()),wpbs_form_saveJson(formJson)}),wpbs("#wpbs-form-container").on("keyup change",".fieldOptions",function(e){e.preventDefault(),formJson=wpbs_form_getJson(),fieldId=wpbs(this).parents(".wpbs-form-field").attr("data-order"),formJson[fieldId].fieldOptions=wpbs_htmlEscape(wpbs(this).val()),wpbs_form_saveJson(formJson)}),wpbs("#wpbs-form-container").on("keyup change",".fieldOptionsLanguage",function(e){e.preventDefault(),formJson=wpbs_form_getJson(),fieldId=wpbs(this).parents(".wpbs-form-field").attr("data-order"),formJson[fieldId].fieldOptionsLanguages[wpbs(this).attr("name")]=wpbs_htmlEscape(wpbs(this).val()),wpbs_form_saveJson(formJson)}),wpbs("#wpbs-form-container").on("keyup change",".fieldHTML",function(e){e.preventDefault(),formJson=wpbs_form_getJson(),fieldId=wpbs(this).parents(".wpbs-form-field").attr("data-order"),formJson[fieldId].fieldHTML=wpbs_htmlEscape(wpbs(this).val()),wpbs_form_saveJson(formJson)}),wpbs("#wpbs-form-container").on("keyup change",".languageField",function(e){e.preventDefault(),formJson=wpbs_form_getJson(),fieldId=wpbs(this).parents(".wpbs-form-field").attr("data-order"),formJson[fieldId].fieldLanguages[wpbs(this).attr("name")]=wpbs_htmlEscape(wpbs(this).val()),wpbs_form_saveJson(formJson)}),wpbs("#wpbs-form-container").on("change",".fieldRequired",function(e){e.preventDefault(),$val=wpbs(this).prop("checked"),formJson=wpbs_form_getJson(),fieldId=wpbs(this).parents(".wpbs-form-field").attr("data-order"),formJson[fieldId].fieldRequired=$val,wpbs_form_saveJson(formJson)}),wpbs("#wpbs-form-container").sortable({axis:"y",handle:".wpbs-form-move",containment:"parent",stop:function(e,s){sorting=new Array,wpbs.map(wpbs(this).find("div.wpbs-form-field"),function(e){sorting[wpbs(e).attr("data-order")]=wpbs(e).index()+1}),wpbs_sort_forms(sorting)}})});